<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>All Channels - JazzTV API</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f5f7fa;margin:0;padding:20px;color:#222}
  h1{text-align:center;margin-bottom:18px}
  #status{text-align:center;margin-bottom:14px;color:#555}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
  .card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);display:flex;flex-direction:column;align-items:center;transition:.2s}
  .card:hover{transform:translateY(-3px);box-shadow:0 6px 14px rgba(0,0,0,0.12)}
  .logo{width:120px;height:68px;object-fit:contain;margin-bottom:8px;background:#eef;padding:5px;border-radius:8px}
  .title{font-weight:600;text-align:center;margin-bottom:6px;font-size:15px}
  .btn{display:inline-block;padding:6px 12px;border-radius:8px;text-decoration:none;background:#0078d7;color:#fff;font-size:13px}
  .btn:hover{background:#005bb5}
  .meta{font-size:11px;color:#666;margin-top:6px}
</style>
</head>
<body>
<h1>üì∫ Live JazzTV Channels</h1>
<div id="status">Loading channels...</div>
<div id="channels" class="grid"></div>

<script>
async function loadChannels() {
  const status = document.getElementById('status');
  try {
    status.textContent = 'Fetching channels from API...';

    // ‚öôÔ∏è Use a free proxy to bypass 405/CORS
    const api = "https://web.jazztv.pk/alpha/api_gateway/v3/web/all-channels";
    const proxy = "https://api.allorigins.win/get?url=" + encodeURIComponent(api);

    const res = await fetch(proxy);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const wrapper = await res.json();
    const data = JSON.parse(wrapper.contents);

    renderChannels(data);
    status.textContent = 'Channels loaded successfully ‚úÖ';
  } catch (err) {
    status.textContent = '‚ùå Failed to load channels: ' + err.message;
    console.error(err);
  }
}

function renderChannels(payload) {
  const container = document.getElementById('channels');
  container.innerHTML = '';
  const list = payload?.channels || payload?.data || payload || [];
  if (!Array.isArray(list) || list.length === 0) {
    container.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#777;">No channels found or wrong structure</div>';
    console.log('Payload:', payload);
    return;
  }

  list.forEach(ch => {
    const name = ch.name || ch.title || ch.channel_name || 'Unnamed';
    const logo = ch.logo || ch.logo_url || ch.icon || '';
    const stream = ch.stream_url || ch.stream || ch.url || '';

    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <img class="logo" src="${logo || 'https://via.placeholder.com/150x80?text=No+Logo'}" alt="${name}">
      <div class="title">${name}</div>
      <a class="btn" href="${stream || '#'}" target="_blank">Watch Live</a>
      <div class="meta">ID: ${ch.id ?? ch.channel_id ?? '-'}</div>
    `;
    container.appendChild(div);
  });
}

loadChannels();
</script>
</body>
</html>
