<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Streaming App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body {margin:0;font-family:Arial,sans-serif;background:#111;color:#fff;}
header{background:#222;padding:15px;text-align:center;font-size:24px;}
.search-bar{display:flex;justify-content:center;margin:15px 0;}
.search-bar input{padding:10px;width:50%;border-radius:5px;border:none;}
.stream-list{display:flex;flex-wrap:wrap;padding:10px;gap:15px;justify-content:center;}
.stream{background:#333;padding:10px;border-radius:8px;width:260px;text-align:center;}
.stream h3{font-size:18px;margin:5px 0;}
video{width:100%;border-radius:8px;margin-top:10px;background:#000;}
button{padding:8px 12px;margin-top:8px;background:#ff6600;border:none;border-radius:5px;color:white;cursor:pointer;}
@media(max-width:600px){.stream{width:90%;}.search-bar input{width:80%;}}
</style>
</head>
<body>

<header>Streaming App</header>
<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search streams...">
</div>
<div class="stream-list" id="streamList"></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
// Firebase public JSON URL (must allow CORS)
const firebaseURL = 'https://hamaro-tv-lite-default-rtdb.firebaseio.com/streams.json';
let streamsData = {};

async function loadStreams(){
    try{
        const res = await fetch(firebaseURL);
        const data = await res.json();
        streamsData = data || {};
        displayStreams(data);
    }catch(err){
        console.error('Error fetching streams:',err);
        document.getElementById('streamList').innerHTML = '<p style="text-align:center;color:red;">Failed to load streams. Check CORS or URL.</p>';
    }
}

function displayStreams(data){
    const container = document.getElementById('streamList');
    container.innerHTML = '';
    for(let key in data){
        const stream = data[key];
        const div = document.createElement('div');
        div.className='stream';
        div.innerHTML=`
            <h3>${stream.name || 'No Name'}</h3>
            <video id="video_${key}" controls></video>
            <button onclick="playStream('${key}','${stream.url}')"><i class="fas fa-play"></i> Play</button>
        `;
        container.appendChild(div);
    }
}

function playStream(id,url){
    const video = document.getElementById('video_' + id);
    if(Hls.isSupported()){
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED,function(){video.play();});
    }else if(video.canPlayType('application/vnd.apple.mpegurl')){
        video.src = url;
        video.addEventListener('loadedmetadata',function(){video.play();});
    }
}

// Search functionality
document.getElementById('searchInput').addEventListener('input',function(){
    const query = this.value.toLowerCase();
    const filtered = Object.fromEntries(
        Object.entries(streamsData).filter(([k,v]) => v.name.toLowerCase().includes(query))
    );
    displayStreams(filtered);
});

// Auto refresh every 30 sec
loadStreams();
setInterval(loadStreams,30000);
</script>

</body>
</html>
